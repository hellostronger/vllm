# vLLM CLI æ‰§è¡Œæµç¨‹å›¾è§£

## ğŸ¯ æ‰§è¡Œè·¯å¾„å¯è§†åŒ–

```mermaid
graph TD
    A[vllm serve Qwen/Qwen3-0.6B] --> B[main.py: main() å‡½æ•°å…¥å£]
    B --> C[å¯¼å…¥å‘½ä»¤æ¨¡å—<br/>CMD_MODULES = [...]]
    C --> D[éå†æ³¨å†Œå‘½ä»¤<br/>for cmd_module in CMD_MODULES]
    D --> E[serve.py: cmd_init()<br/>è¿”å› ServeSubcommand()]
    E --> F[è®¾ç½®åˆ†å‘å‡½æ•°<br/>set_defaults(dispatch_function=cmd.cmd)]
    F --> G[å‚æ•°è§£æ<br/>parser.parse_args()]
    G --> H{args.subparser == 'serve'?}
    H -->|æ˜¯| I[è°ƒç”¨ dispatch_function<br/>args.dispatch_function(args)]
    H -->|å¦| J[æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯]
    I --> K[ServeSubcommand.cmd(args)<br/>serve.py ç¬¬84è¡Œ]
    K --> L{api_server_count åˆ¤æ–­}
    L -->|< 1| M[run_headless(args)]
    L -->|= 1| N[uvloop.run(run_server(args))]
    L -->|> 1| O[run_multi_api_server(args)]
    
    style A fill:#e1f5fe
    style I fill:#fff3e0
    style K fill:#f3e5f5
    style N fill:#e8f5e8
```

## ğŸ” å…³é”®ä»£ç ä½ç½®æ ‡æ³¨

### 1. **ç¨‹åºå…¥å£** (main.py)
```python
# ç¬¬144è¡Œ - ç¨‹åºå¯åŠ¨ç‚¹
if __name__ == "__main__":
    main()  # â† è¿™é‡Œå¼€å§‹æ‰§è¡Œ
```

### 2. **å‘½ä»¤æ³¨å†Œå¾ªç¯** (main.py ç¬¬113-120è¡Œ)
```python
# ç¬¬116è¡Œ - è°ƒç”¨å„æ¨¡å—çš„åˆå§‹åŒ–å‡½æ•°
new_cmds = cmd_module.cmd_init()

# ç¬¬118è¡Œ - è®¾ç½®å‘½ä»¤åˆ†å‘å‡½æ•°ï¼ˆå…³é”®ï¼ï¼‰
cmd.subparser_init(subparsers).set_defaults(dispatch_function=cmd.cmd)
```

### 3. **å‘½ä»¤åˆ†å‘ç‚¹** (main.py ç¬¬137è¡Œ) â­ **æœ€é‡è¦**
```python
# ç¬¬137è¡Œ - å®é™…è°ƒç”¨ serve å‘½ä»¤é€»è¾‘çš„åœ°æ–¹
if hasattr(args, "dispatch_function"):
    args.dispatch_function(args)  # â† è¿™é‡Œè¿›å…¥ serve.cmd()
```

### 4. **serve å‘½ä»¤ä¸»é€»è¾‘** (serve.py ç¬¬84è¡Œ)
```python
# ç¬¬84è¡Œ - serve å‘½ä»¤çš„å®é™…å¤„ç†å‡½æ•°
@staticmethod
def cmd(args: argparse.Namespace) -> None:
    # è¿™é‡Œå¤„ç†æ‰€æœ‰çš„ serve å‘½ä»¤é€»è¾‘
    # åŒ…æ‹¬å‚æ•°å¤„ç†ã€æ¨¡å¼åˆ¤æ–­ã€æœåŠ¡å¯åŠ¨ç­‰
```

## ğŸ”„ å®Œæ•´è°ƒç”¨æ ˆ

```
1. ç”¨æˆ·è¾“å…¥: vllm serve Qwen/Qwen3-0.6B
   â†“
2. main.py:144 - if __name__ == "__main__": main()
   â†“
3. main.py:42 - CMD_MODULES åŠ è½½æ‰€æœ‰å‘½ä»¤æ¨¡å—
   â†“
4. main.py:116 - cmd_module.cmd_init() 
   â”œâ”€ serve.py:195 - cmd_init() è¿”å› [ServeSubcommand()]
   â†“
5. main.py:118 - set_defaults(dispatch_function=ServeSubcommand.cmd)
   â†“
6. main.py:125 - parser.parse_args() è§£æå‚æ•°
   â†“
7. main.py:137 - args.dispatch_function(args) â­ å…³é”®è°ƒç”¨ç‚¹
   â†“
8. serve.py:84 - ServeSubcommand.cmd(args) å¼€å§‹æ‰§è¡Œ serve é€»è¾‘
   â†“
9. æ ¹æ®é…ç½®é€‰æ‹©æ‰§è¡Œè·¯å¾„:
   â”œâ”€ run_headless(args)     # æ— å¤´æ¨¡å¼
   â”œâ”€ run_server(args)       # å•è¿›ç¨‹æ¨¡å¼ â† æœ€å¸¸ç”¨
   â””â”€ run_multi_api_server(args) # å¤šè¿›ç¨‹æ¨¡å¼
```

## ğŸ¯ å¿«é€Ÿå®šä½æŒ‡å—

å¦‚æœä½ æƒ³è°ƒè¯•æˆ–ç†è§£æŸä¸ªç¯èŠ‚ï¼š

- **æƒ³çœ‹å‘½ä»¤å¦‚ä½•æ³¨å†Œï¼Ÿ** â†’ æŸ¥çœ‹ `main.py` ç¬¬113-120è¡Œ
- **æƒ³çœ‹å‚æ•°å¦‚ä½•è§£æï¼Ÿ** â†’ æŸ¥çœ‹ `main.py` ç¬¬125è¡Œ  
- **æƒ³çœ‹å‘½ä»¤å¦‚ä½•åˆ†å‘ï¼Ÿ** â†’ æŸ¥çœ‹ `main.py` ç¬¬137è¡Œ â­
- **æƒ³çœ‹ serve å…·ä½“é€»è¾‘ï¼Ÿ** â†’ æŸ¥çœ‹ `serve.py` ç¬¬84è¡Œå¼€å§‹
- **æƒ³çœ‹ HTTP æœåŠ¡å¯åŠ¨ï¼Ÿ** â†’ æŸ¥æ‰¾ `run_server()` å‡½æ•°è°ƒç”¨

## ğŸ’¡ è®¾è®¡äº®ç‚¹

è¿™ç§è®¾è®¡æ¨¡å¼çš„ä¼˜ç‚¹ï¼š
1. **æ’ä»¶åŒ–æ¶æ„** - æ–°å¢å‘½ä»¤åªéœ€å®ç°æ ‡å‡†æ¥å£
2. **ç»Ÿä¸€å…¥å£** - æ‰€æœ‰å‘½ä»¤é€šè¿‡ç›¸åŒè·¯å¾„åˆ†å‘
3. **è§£è€¦åˆ** - å„å‘½ä»¤æ¨¡å—ç›¸äº’ç‹¬ç«‹
4. **å¯æ‰©å±•** - æ˜“äºæ·»åŠ æ–°çš„å­å‘½ä»¤